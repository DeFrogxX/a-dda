# Makefile for sequential version of ADDA package
# All options are defined in Makefile
# AUTH: Maxim Yurkin

# !!! This file do not have any options designed to be changed by ADDA user

MFILES += make_seq $(LASTSEQ)

#===============================================================================
# Main action part
#===============================================================================

.DELETE_ON_ERROR:


$(PROGSEQ): $(COBJECTS) $(FOBJECTS) 
	$(CC) -o $@ $(LFLAGS) $(COBJECTS) $(FOBJECTS) $(LDLIBS)

# Everything is recompiled (but not dependencies)
# when any of makefiles is changed
$(COBJECTS): %.o: %.c %.d $(MFILES)
	$(CC) -c $(CFLAGS) $<

$(FOBJECTS): %.o: %.f $(MFILES)
	$(CF) -c $(FFLAGS) $<

$(LASTSEQ):
	echo "void" > $(LASTSEQ)

# Dependencies are only generated for C sources;
# we assume that each Fortran file is completely independent

$(CDEPEND): %.d: %.c $(MFILES)
	$(CC) $(DEPFLAG) $(CFLAGS) $< $(DFFLAG) $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

include $(CDEPEND)
