#summary Several examples of comparison of ADDA with other codes

Many researchers have used `ADDA` and compared it with other codes based on the DDA or other light scattering methods. The purpose of this page is to give a few representative examples instead of providing a full overview. Figures on this page are either in vector format (svg) or can be clicked to open a larger image.

<wiki:toc />

= Other DDA codes =

Comparison of four different DDA codes, including `ADDA` 0.7a and [http://www.astro.princeton.edu/~draine/DDSCAT.6.1.html DDSCAT 6.1], was performed by Penttila et al. [[#References 1]] for simulation of different wavelength-sized particles both in single orientation and averaged over all orientations. Here we present a brief summary and a few sample results from this paper. `ADDA` is faster than other codes by a factor of 2.3 to 16 and it is the least memory consuming code. Results of simulations of light scattering by a sphere in a fixed orientation are shown in the following figure. All scatterers considered in this section have volume-equivalent size parameter 5.1 and refractive index 1.313. `SIRRI` and `ZDD` denote codes by Simulintu Oy in Finland and Zubko and Shkuratov respectively. All codes result in almost identical relative error of _S_,,11,,(_θ_), as compared with the Mie theory, showing that the codes use the same formulation of DDA, except `SIRRI` that is slightly different.

http://a-dda.googlecode.com/svn/wiki/sphere_dda.svg

On contrary, orientation averaging schemes of the codes are different. Orientation averaged results for a randomly constructed aggregate of 50 spheres are shown in the next figure (here and below reference results are obtained using the T-matrix method). One can see that results differ, and the errors of `ADDA` results are the largest. That is explained by the fact that for `ADDA` we used 16×9×8 sample points for Euler angles _α_, _β_, and _γ_ respectively. Other codes used less _α_ sample angles (11, 4, and 1) but more _β_ and _γ_ sample angles, resulting in approximately the same total number of sample angles. Therefore, `ADDA` is faster at expense of possible deterioration of accuracy. However, for other asymmetric particles studied in [[#References 1]] `ADDA` results in comparable to other codes accuracy even with current settings (particle showed here was the least favorable for `ADDA`).

http://a-dda.googlecode.com/svn/wiki/aggregate_dda.svg

The results for axisymmetric particles are principally different. Here we consider only a prolate spheroid with aspect ratio 2 (see the next figure). One can see that `ADDA` result (the first curve) is much less accurate than other codes. The accuracy of `ADDA` is unusually bad, even compared to the previous figure. In the following we explain this fact. For axisymmetric particles the dipole array is symmetric with respect to 90° rotation over the symmetry axis. Moreover, the range from 0° to 90° for _γ_ is mirror symmetric with respect to the 45°. Hence, the most efficient way of orientation averaging for such particles is to sample _γ_ uniformly in the range from 0° to 45°, and also to use less _γ_ sample angles but more _β_ sample angles. Sampling by other codes satisfies these conditions. The situation for `ADDA` is remarkably different. 8 _γ_ angles are used, which are spaced with interval 45°, hence they map in only two distinct angles (0° and 45°) inside the reduced range. That means that for axisymmetric particles `ADDA` repeats calculation for four equivalent sets of orientations. Moreover, Romberg integration, which is a higher order method, performs unsatisfactory when applied to a range that contains several periods of the periodic function to be integrated and only a few points per each period. An analogous discussion applies to the _β_ angle since both spheroid and cylinder have a symmetry plane perpendicular to the symmetry axis.

http://a-dda.googlecode.com/svn/wiki/spheroid_dda.svg

It is important to note that `ADDA` is perfectly suitable to calculate orientation averaging of axisymmetric particles efficiently, but it requires a user to manually modify the sampling intervals for Euler angles in the input files. For instance, for the discussed scatterers the choice of 17 _β_ angles from 0° to 90° and 5 _γ_ angles from 0° to 45° is appropriate. The result of this tuned orientation averaging for spheroid, obtained using `ADDA` 0.76, is shown as the last curve in the previous figure. It requires about 20% more computational time than the initial scheme, but still it is significantly faster than other codes. One can see that its accuracy is comparable to or even better than that of other codes. This result was not included in [[#References 1]], because such modifications of the input files were considered a ‘fine-tuning’. `DDSCAT` may also benefit from reduction of angle ranges, but in much lesser extent (in these particular cases).

Therefore, we may conclude that `ADDA` is clearly superior for particles in single orientation. Its orientation averaging scheme is not that flexible, especially when small number of sample angles is used. However, in most cases it results in accuracy not worse than that of other codes, if particle symmetries are properly accounted for. Moreover, inflexibility is compensated by the adaptability of the `ADDA` orientation averaging scheme and its ability to estimate the averaging error. We should also note, that the optimum strategy for orientation averaging is still an open question (see e.g. issue 40).

Finally, the described comparison is already outdated. Both `ADDA` and `DDSCAT` have undergone significant improvement since that time. Moreover, a new code [http://www.opendda.org/ OpenDDA] have been released, claiming superior computational efficiency.

= Multiple multipole program (Gaussian beam) =

To validate the part of `ADDA`, which simulates scattering by a Gaussian beam, we conducted a simple test and compared results with that of the [http://www.scattport.org/index.php/programs-menu/generalized-multipole-menu/49-3d-mmp multiple multipole program]. The latter were provided by Roman Schuh and Thomas Wriedt. Sphere with size parameter 5 and refractive index 1.5 is illuminated with a Gaussian beam with wavelength 1 µm, width 2 µm, and position of the beam center (1,1,1) µm. The beam propagates along the _z_-axis. We calculated _S_,,11,,(_θ_) in the _yz_-plane, scattering angle _θ_ was considered from the _z_-axis to the _y_-axis. We used 64 dipoles per diameter of the sphere. `ADDA` 0.76 was used with a command line:
{{{
adda -grid 64 -lambda 1 -size 1.59155 -beam barton5 2 1 1 1 -ntheta 180
}}}
The results are shown in the following figure, indicating perfect agreement between two methods.

http://a-dda.googlecode.com/svn/wiki/mmp_dda.svg

= Null-field method with discrete sources (anisotropic material) =

Schmidt and Wriedt [[#References 2]] extended the null-field method with discrete sources ([http://www.scattport.org/index.php/programs-menu/t-matrix-codes-menu/239-nfm-ds NFM-DS]) to anisotropic scatterers and verified their code by comparison with `ADDA` and `DDSCAT`. The following figure shows one particular example for ellipsoid with semi-axes _ka_=2, _kb_=3, _kc_=4 (_k_ is the wavenumber) and refractive index _m,,x,,_=1.5, _m,,y,,_=_m,,z,,_=1.1. Incident wave propagates along the _z_-axis and _S_,,11,, is calculated in _xz_-plane. NFM-DS data was provided by Vladimir Schmidt. `ADDA` 0.79 was run with the following command line.
{{{
adda -size 4 -shape ellipsoid 1.5 2 -m 1.5 0 1.1 0 1.1 0 -anisotr -orient 90 0 0
}}}
where the last option (`-orient`) was used for convenience to make the first two columns of the file `mueller`  produced by `ADDA` (corresponding to _yz_-plane in particle reference frame) equivalent to the sought _S_,,11,, in _xz_-plane in laboratory reference frame.

http://a-dda.googlecode.com/svn/wiki/nfmds_dda.svg

= Finite difference time domain method =

A systematic comparison of the DDA and the finite difference time domain (FDTD) method was performed for large dielectric scatterers by Yurkin et al. [[#References 3]]. Here we summarize these results. Simulations were performed for spheres with size parameter _x_ from 20 to 80 and refractive index _m_ from 1.02 to 2 (all _m_ also had a fixed negligible imaginary part). Since both methods are potentially exact if infinite discretization is employed, a certain accuracy was required – relative error of _Q_,,ext,, less than 1% and the root-mean-square relative error of _S_,,11,, over the whole range of _θ_ less than 25%. Then simulation times were compared. `ADDA` v.0.76 was used as DDA implementation, and FDTD implementation was developed in the Biomedical Laser Laboratory at East Carolina University, based on the algorithms described by Yang and Liou with numerical dispersion correction (see [[#References 3]] for details).

The main conclusion is summarized in the following figure, where a ratio of computational times of two methods is shown versus _x_ for different _m_. The DDA is more than an order of magnitude faster for _m_ ≤1.2 and _x_>30, while for _m_ ≥1.7 the FDTD is faster by the same extent. _m_=1.4 is a boundary value, for which both methods perform comparably. The DDA errors of _S_,,11,,(_θ_) for _m_=1.02 are mostly due to the shape errors, which are expected to be smaller for rough and/or inhomogeneous particles. Simulations for a few sample biological cells lead to the same conclusions. Although these conclusions depend on particular scattering quantity and on the implementations of both methods, they will not change principally unless a major improvement of one of the method is made. However, for general complex refractive indices the results of the comparison are expected to be significantly different.

http://a-dda.googlecode.com/svn/wiki/fdtd_dda.svg

= Pseudo-spectral time domain method =

A systematic comparison of the DDA and the pseudo-spectral time domain (PSTD) method was performed for large dielectric scatterers by Liu et al. [[#References 4]]. Here we summarize these results. Overall method of comparison was analogous to [ComparisonOtherCodes#Comparison_with_the_finite_difference_time_domain_method that for the FDTD]. Simulations were performed for spheres with size parameter _x_ from 10 to 100 and refractive index _m_ from 1.2 to 2. The following accuracy was required – relative error of _Q_,,ext,, less than 1% and the root-mean-square relative error of _S_,,11,, over the whole range of _θ_ less than 25%. Then simulation times were compared. `ADDA` v.0.79 with the default settings was used as DDA implementation, and PSTD implementation was developed in the Department of Atmospheric Sciences of Texas A&M University (see [[#References 4]] for details).

The main conclusion is summarized in the following figure, where the regions of superiority of the DDA and the PSTD are shown. Differences of the simulation times (to reach the same accuracy) were up to a factor of 100 (both ways). Simulations for a few sample spheroidal particles lead to the same conclusions.

http://a-dda.googlecode.com/svn/wiki/pstd_dda.svg

Although these conclusions depend on particular scattering quantity and on the implementations of both methods, they will not change principally unless a major improvement of one of the method is made. In particular, we have tried to push `ADDA` to the limit for two spheres (_x_=10, _m_=2 and _x_=80, _m_=1.2). We tried different DDA formulations and iterative solvers, resulting in 14 and 4 times decrease of computational time for these two cases, respectively. However, these times were still two-three times larger than that of the PSTD. However, for general complex refractive indices and/or inhomogeneous particles the results of the comparison are expected to be significantly different.

= Improved geometric optics method =

Bi et al. compared `ADDA` with the improved geometric optics method (IGOM) for simulation of randomly-oriented ellipsoids [[#References 5]] and hexahedra [[#References 6]]. The accuracy of the `ADDA` was assumed good enough (unfortunately, the details of the DDA simulations were not specified), while accuracy of IGOM is tested against it. A particular example from [[#References 6]] is shown in the following figure, depicting integrated scattering properties of randomly oriented nonsymmetric hexahedra versus the size parameter. One can see that both methods agree in intermediate size parameter range, thus effectively closing the gap between geometric-optics and wave-optics methods. However, the deviations for angle-resolved light scattering properties ,e.g. _S_,,11,,, can still be significant (see [[#References 6]] for details).

[http://a-dda.googlecode.com/svn/wiki/igom_dda_large.png http://a-dda.googlecode.com/svn/wiki/igom_dda_small.png]

= `Tsym` for cubes =

`ADDA` was compared with `Tsym`, a T-matrix code employing discrete symmetries of the scatterer, for a number of cubes with _kD_=0.1 and 8 (_k_ is the wavenumber, _D_ is the cube edge) and refractive index _m_=1.6+0.01i, 0.1+i, and 10+10i [[#References 7]], pushing the accuracy of both codes to the limit. Here we present only the results for one case - _kD_=8 and _m_=1.6+0.01i. The cube is in fixed orientation with edges along the axes. `ADDA` v.0.78.2 was used with default settings, except for the FCD formulation and 10^−10^ convergence threshold for the iterative solver. The command line was the following:
{{{
adda -size 8 -m 1.6 0.01 -ntheta 180 -shape box -int fcd -pol fcd -eps 10 -grid <nx>
}}}
where 5 grid sizes (`<nx>`) were used from 256 to 512, and extrapolation technique [[#References 8]] was employed afterwards. Also, a special technique was used for `Tsym` results to estimate computational accuracy. Results for the integral scattering quantities are summarized in the following table. Uncertainties (±) are in the last shown digits of the corresponding value and have nominal confidence level of 95%.
|| || _Q_,,ext,, || _Q_,,sca,, || _Q_,,abs,, ||
|| `ADDA` || 4.2480442 ± 3 || 3.9715646 ± 3 || 0.2764796 ± 1 ||
|| `Tsym` || 4.24775 ± 33 || 3.97156 ± 24 || 0.2757 ± 7 ||

Below is the results for intensity _I_=_S_,,11,, in the _yz_-plane, showing relative differences between the two methods and their internal error estimates.

http://a-dda.googlecode.com/svn/wiki/tsym_dda.svg

= Particles near surface =

To validate the part of `ADDA`, which implements simulation of optical properties of particles near surface, we compared it with a number of other methods.

First test is for Fe prolate spheroid (semi-axes 25nm and 50nm, refractive index 1.35+1.97i) placed on Si substrate (refractive index 4.37+0.08i), illuminated by plane wave from above propagating at 45° relative to the surface normal. Wavelength is 488nm. `ADDA` v.1.3b2 (r1266) was used with a command line
{{{
adda -shape ellipsoid 1 2 -size 0.05 -lambda 0.488 -surf 0.05 4.37 0.08 -m 1.35 1.97 -grid <nx> -prop 1 0 -1 -ntheta 180
}}}
where `<nx>` varied between 16 and 64. Shown below is normalized (to have maximum value of 1) perpendicular and parallel (to scattering plane) scattering intensities. Scattering angle corresponds to the spherical angle _θ_ of laboratory reference frame inside the main scattering plane (given by incident and reflected direction).

http://a-dda.googlecode.com/svn/wiki/Fe_spheroid.svg

Reference results are T-matrix simulations, digitized from Fig.4.7 of [[#References 9]] with appropriate modification of scattering angle definition. The agreement is perfect for perpendicular intensity, but there are some discrepancies for parallel. The latter, however, clearly diminish with refining discretization, and the remaining difference is compared to that between the T-matrix and discrete-sources-method in [[#References 9]] (data not shown).

A second test is for Ag sphere (radius _R_=50nm, refractive index 0.25+3.14i) placed on glass substrate (refractive index _m_,,s,,=1.5), illuminated by plane wave from below propagating at 60° relative to the surface normal (evanescent illumination). Wavelength is 488nm. `ADDA` v.1.3b4 was used with command line
{{{
adda -size 0.1 -lambda 0.488 -surf 0.05 1.5 0 -m 0.25 3.14 -prop 1 0 0.577350 -ntheta 180 -grid 64
}}}
Shown below are perpendicular and parallel scattering intensities (_S_,,11,,−_S_,,12,, and _S_,,11,,+_S_,,12,, respectively) in the main scattering plane.

http://a-dda.googlecode.com/svn/wiki/Ag_sphere.svg

Reference T-matrix results are given in Fig.4.10 of [[#References 9]], but they were recalculated by Vladimir Schmidt using [http://www.scattport.org/index.php/programs-menu/t-matrix-codes-menu/239-nfm-ds NFM-DS]. The latter raw results were multiplied by a factor _π_(_kR_)^2^/_m_,,s,,, where _k_ is the free-space wavenumber.

= Decay rate enhancements =
The test data for this section were provided by Stefania D'Agostino. The goal is to validate the part of `ADDA`, related to the point-dipole incident field, by comparing it with exact electromagnetic theory (EET) for a silver sphere (diameter 10 nm). EET is described in [[#References 10]], and the data were calculated with the [http://erbium.amolf.nl/ online applet]. The refractive index of silver is from Palik [[#References 11]] with linear interpolation. First, the decay-rate enhancements (total as well as radiative and non-radiative parts) at the wavelength of 354nm were calculated as a function of dipole distance from sphere surface for parallel and perpendicular orientations of the dipole with respect to sphere surface. `ADDA` v.1.3b4 was used with a command line
{{{
adda -beam dipole 0 0 <z> -prop <ori> -size 10 -lambda 354 -m 0.20959 1.43592 -sym enf -grid 160
}}}
where `<z>` is the distance from dipole to sphere center (in nm), i.e. distance from surface + 5, and `<ori>` is "1 0 0" or "0 0 1" for parallel and perpendicular orientations of the dipole respectively. The results are similar to Fig.1 of [[#References 12]], which were obtained with a previous version of `ADDA` using a number of code hacks and workarounds. Now only `ADDA` itself is required for such simulations.

http://a-dda.googlecode.com/svn/wiki/DRE_distance.svg

Second, convergence of the results with refining discretization was studied for total decay-rate enhancement for a dipole (in two orientations) at 5 nm from the sphere surface as a function of the wavelength. The command line is
{{{
adda -beam dipole 0 0 10 -prop <ori> -size 10 -lambda <lam> -m <mre> <mim> -sym enf -grid <nx>
}}}  
where `<nx>` is either 80 or 160, `<lam>` is the wavelength (in nm), and `<mre>` and `<mim>` are the corresponding real and imaginary parts of the refractive index.

http://a-dda.googlecode.com/svn/wiki/DRE_lambda.svg

The agreement with EET becomes better with refining discretization. Moreover, if we use the simplest Richardson-type extrapolation of the DDA results to zero dipole size (see [[#References 8]] for justification), i.e. 2×(result for _n,,x,,_=160) - (result for _n,,x,,_=80), the agreement (green vs. blue line in the figure) is almost perfect (in many cases withing the line width).

= References =
 # A. Penttila, E. Zubko, K. Lumme, K. Muinonen, M. A. Yurkin, B. T. Draine, J. Rahola, A. G. Hoekstra, and Y. Shkuratov, “Comparison between discrete dipole implementations and exact techniques,” [http://dx.doi.org/10.1016/j.jqsrt.2007.01.026 J. Quant. Spectrosc. Radiat. Transfer 106, 417-436 (2007)].
 # V. Schmidt and T. Wriedt, “T-matrix method for biaxial anisotropic particles,” [http://dx.doi.org/10.1016/j.jqsrt.2009.01.025 J. Quant. Spectrosc. Radiat. Transfer 110, 1392-1397 (2009)].
 # M. A. Yurkin, A. G. Hoekstra, R. S. Brock, and J. Q. Lu, “Systematic comparison of the discrete dipole approximation and the finite difference time domain method for large dielectric scatterers,” [http://dx.doi.org/10.1364/OE.15.017902 Opt. Express 15, 17902-17911 (2007)].
 # C. Liu, L. Bi, R. L. Panetta, P. Yang, and M. A. Yurkin, “Comparison between the pseudo-spectral time domain method and the discrete dipole approximation for light scattering simulations,” [http://dx.doi.org/10.1364/OE.20.016763 Opt. Express 20, 16763–16776 (2012)].
 # L. Bi, P. Yang, G. W. Kattawar, and R. Kahn, “Single-scattering properties of triaxial ellipsoidal particles for a size parameter range from the Rayleigh to geometric-optics regimes,” [http://dx.doi.org/10.1364/AO.48.000114 Appl. Opt. 48, 114-126 (2009)].
 # L. Bi, P. Yang, G. W. Kattawar, and R. Kahn, “Modeling optical properties of mineral aerosol particles by using nonsymmetric hexahedra,” [http://dx.doi.org/10.1364/AO.49.000334 Appl. Opt. 49, 334-342 (2010)].
 # M. A. Yurkin and M. Kahnert, “Light scattering by a cube: accuracy limits of the discrete dipole approximation and the T-matrix method,” [http://dx.doi.org/10.1016/j.jqsrt.2012.10.001 J. Quant. Spectrosc. Radiat. Transfer 123, 176–183 (2013)].
 # M. A. Yurkin, V. P. Maltsev, and A. G. Hoekstra, “Convergence of the discrete dipole approximation. II. An extrapolation technique to increase the accuracy,” [http://dx.doi.org/10.1364/JOSAA.23.002592 J. Opt. Soc. Am. A 23, 2592–2601 (2006)].
 # A. Doicu, R. Schuh, and T. Wriedt, “Scattering by particles on or near a plane surface,” in _Light Scattering Reviews 3_, A. A. Kokhanovsky, Ed., [http://link.springer.com/chapter/10.1007/978-3-540-48546-9_4 pp. 109–130, Springer, Berlin (2008)].
 # H. Mertens, A. Koenderink, and A. Polman, “Plasmon-enhanced luminescence near noble-metal nanospheres: Comparison of exact theory and an improved Gersten and Nitzan model,” [http://dx.doi.org/10.1103/PhysRevB.76.115123 Phys. Rev. B 76 (2007)].
 # D. W. Lynch and W. R. Hunter, “Comments on the optical constants of metals and an introduction to the data for several metals,” in _Handbook of Optical Constants of Solids_, E. D. Palik, Ed., pp. 275–267, Academic Press, San Diego (1985).
 # S. D’Agostino, F. Della Sala, and L. C. Andreani, “Dipole-excited surface plasmons in metallic nanoparticles: Engineering decay dynamics within the discrete-dipole approximation,” [http://dx.doi.org/10.1103/PhysRevB.87.205413 Phys. Rev. B 87, 205413 (2013)].